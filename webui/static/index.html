<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Logic Simulator</title>
  
  <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/mode/simple.min.js"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
  <script src="circuit_mode.js"></script>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <header>
    <div>
      Logic Simulator - <a href="#" id="mainReadmeBtn" style="color: #aaddff; text-decoration: none;">View Project README</a>
    </div>
    <button id="themeToggle" class="theme-toggle" title="Toggle dark/light mode">
      <span class="theme-icon">ðŸŒ™</span>
    </button>
  </header>
  
  <div class="editor-section">
    <textarea id="code"># Macro Definitions (using only NAND as a primitive gate)
# Checksum (Parity) Circuit Example Solution
# Computes the parity (XOR of all bits) of input X

# Macro definitions (using only NAND as a primitive gate)
NOT(x)      := NAND(x, x)
AND(x,y)    := NOT(NAND(x, y))
OR(x,y)     := NAND(NOT(x), NOT(y))
XOR(x,y)    := OR(AND(NOT(x), y), AND(x, NOT(y)))

# Use a D flip-flop to accumulate the running parity
# At each step, parity = XOR of previous parity and current bit
Y = XOR(D(Y, 0), X)
</textarea>
    
    <div class="panel inputs-panel">
      <label>Inputs (X=101;Y=11): <input id="inputs" style="width:260px" value="I=0010010100101111" /></label>
      <label>Steps: <input id="steps" type="number" value="16" min="1" max="256" /></label>
      <button id="runBtn"><span class="btn-content"><span class="play-icon" style="font-size:0.9em;">&#9654;</span>Simulate</span></button>
    </div>
  </div>
  
  <div class="resizer" id="resizer"></div>
  
  <div class="outputs-section">
    <h3>Outputs</h3>
    <div id="outputs"></div>
  </div>
  
  <div id="errorModal" class="modal" style="display:none;">
    <div class="modal-content">
      <button class="modal-close" onclick="document.getElementById('errorModal').style.display='none'">&times;</button>
      <div id="errormsg"></div>
    </div>
  </div>
  
  <div id="logModal" class="modal" style="display:none;">
    <div class="modal-content">
      <button class="modal-close" onclick="document.getElementById('logModal').style.display='none'">&times;</button>
      <h3>Log</h3>
      <pre id="log"></pre>
    </div>
  </div>
  
  <div id="scoreModal" class="modal" style="display:none;">
    <div class="modal-content">
      <button class="modal-close" onclick="document.getElementById('scoreModal').style.display='none'">&times;</button>
      <h3>Score Result</h3>
      <div id="scoreresult"></div>
    </div>
  </div>
  
  <div id="readmeModal" class="modal" style="display:none;">
    <div class="modal-content">
      <button class="modal-close" onclick="document.getElementById('readmeModal').style.display='none'">&times;</button>
      <div id="readmeContent"></div>
    </div>
  </div>
  
  <footer>
    <div id="challengesPanel">
      <span style="font-weight: bold; margin-right: 5px;">Challenges:</span>
    </div>
    <div id="footerControls">
      <button id="logMenuBtn">Show Log</button>
    </div>
  </footer>

  <script src="app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script>
      document.addEventListener('DOMContentLoaded', function () {
          mermaid.initialize({ startOnLoad: false });
      });
  </script>
</body>
</html>